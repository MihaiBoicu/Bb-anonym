# Anonymizing the Sessions

Contributers:
- Anushree Manoharrao Spring 2022

Editor and reviewer:
- Mihai Boicu

## Understanding how to configure the class User Key

The class UserKey is managing a dictionary to anonymize a user's email id (e.g. jdoe) by generating a random integer value betweeen a min and max user codes that are provided in a configuration file. The generated anonymized values are stored in a key file. 

There are two files asssociated with users:
- config/user-config.json: keeps the configuration data on how to generate the anonymized values for the user email ids
- key/userKeys.txt: keeps the current generated anonymized values for the user email ids (if any)

Before you use user keys, you must define the configuration file. However, you must not define the key file, because this will be generated automatically by the code.

### Sample user-config.json
The user-config.json file is defines the values for the min_key and max_key between which the anonymized keys for students email ids are generated:

'''
{
    "min_key": 10000,
    "max_key": 99999
}
'''

=== CHECK FROM HERE
### Sample of output in userKeys.txt

```
jdoe1 24351
jdoe2 45001
```

## Understanding how to call the class Session Key



## Understanding how the class SessionKey is coded

It begins with checking if the userKeys.txt is present or not. Based on that, different functions are executed. If it is present, it executes the load function, otherwise it executes loadConfig function to generate the userKeys.txt which is given by the code below.

'''
def __init__(self):
        self.loadConfig()
        if os.path.isfile(self.KEY_FILE_NAME):
            self.load()
'''

### Understanding of loadConfig()

The function loadConfig() is executed when there is no userKey,txt present beforehand. It begins with first opening the user-config.json from  "../config/user-config.json". The json file is then read by loading it after which the minUserCode and maxUserCode are set based on the values defined in the user-config.json file. The json file is closed at the end of the function. Below code is used to set min and max values.

'''
self.minUserCode = userConfigData['min_key']
self.maxUserCode = userConfigData['max_key']
'''
### Understanding load() function

The function load() is executed when userKeys.txt is already present. It begins with reading the file from  "../key/userKeys.txt" and it is read line by line to  store the values next in the dictionary as a key-value pair upon splitting the already coded userid and his key from the file based on space. It is given by the code below.
The function is ended with the closing of the userKeys.txt file.
'''
 for line in lines:
            elements = line.split(' ')
            self.dictionary[(elements[0])] = int(elements[1])
'''

### Understanding save() function

The userKey.txt file that has been split into keys and values at the end of the load() function, is now sorted based on the keys and the key-value pair is stored.
It is done using the code below.

'''
  file = open(self.KEY_FILE_NAME, "w")
        for keyName in sorted(self.dictionary.keys()):
            file.write(str(keyName) + " " + str(self.dictionary[keyName]) + "\n")
'''

### Understanding get(id) function
Now that all the required functions are defined and understood, the last function is to get the anonymized values for the userids which is done by the get() function. 
The get function has id as a parameter passed to it. It begins with checking if the key is already present from the dictionary of keys that was obtained earlier. If it is present, the same key has been returend for the corresponding id. Else, when there is no key already defined, a new value is generated by capturing a random integer value betweeen the min and max user codes. Only if code, i.e., the newly geerated key is not present in the dictionary, the value is set to be the new anonymized value for the corresponding id. Given by the below code.

'''
 while True:
            code = random.randint(self.minUserCode, self.maxUserCode)
            if not code in self.dictionary.values():
                break
        self.dictionary[str(id)] = code
'''

### Understanding print() function
All the anonymized values in the userKey.txt file are printed using this funciton.

### Sample if userKeys.txt
